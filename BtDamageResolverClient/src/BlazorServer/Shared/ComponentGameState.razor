@using Faemiyah.BtDamageResolver.Client.BlazorServer.Logic
@inject UserStateController _userStateController
@implements IDisposable

@if (_userStateController.GameState != null)
{
     var playerStateList = DisplayOwnUnits ?
            _userStateController.GameState.Players.Select(p => p.Value) :
            _userStateController.GameState.Players.Where(p => p.Value.PlayerId != _userStateController.PlayerName).Select(p => p.Value);

    @foreach(var player in playerStateList)
    {
        <ComponentPlayerState PlayerId = "@player.PlayerId" ></ComponentPlayerState>
    }
}

@code {
    [Parameter]
    public bool DisplayOwnUnits { get; set; }

    protected override void OnInitialized()
    {
        _userStateController.OnUnitListChange += StateHasChanged;
    }

    public void Dispose()
    {
        _userStateController.OnUnitListChange -= StateHasChanged;
    }
}